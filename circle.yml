database:
  override:
   - go get bitbucket.org/liamstask/goose/cmd/goose
    - |
      if [[ $CIRCLE_BRANCH = 'dev' ]]; then
        goose -env development up
      fi
      if [[ $CIRCLE_BRANCH = 'staging' ]]; then
        goose -env staging up
      fi
      if [[ $CIRCLE_BRANCH = 'master' ]]; then
        goose -env production up
      fi

test:
  override:
    - go generate && go build -v && go test ./api ./gruff -v && go vet

deployment:
  master:
    branch: master
    commands:
      - npm i -g up
      - up version
      - up
  qa:
    branch: qa
    commands:
      - npm i -g up
      - up version
      - up
  dev:
    branch: dev
    commands:
      - npm i -g up
      - up version
      - up
